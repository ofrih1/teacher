<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>××¢×¨×›×ª × ×™×”×•×œ ×©×™×¢×•×¨×™×</title>
  <style>
    :root {
      --primary-color: #4CAF50;
      --secondary-color: #2196F3;
      --danger-color: #f44336;
      --warning-color: #FF9800;
      --success-color: #4CAF50;
      --bg-color: #f2f2f2;
      --card-bg: white;
      --text-color: #333;
      --border-color: #ccc;
    }

    [data-theme="dark"] {
      --bg-color: #1a1a1a;
      --card-bg: #2d2d2d;
      --text-color: #fff;
      --border-color: #555;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg-color);
      color: var(--text-color);
      direction: rtl;
      transition: all 0.3s ease;
    }

    nav {
      background: var(--primary-color);
      color: white;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 15px 10px;
      position: relative;
    }

    nav button {
      background: transparent;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      padding: 8px 16px;
      border-radius: 5px;
      transition: background 0.3s ease;
    }

    nav button:hover {
      background: rgba(255,255,255,0.2);
    }

    .theme-toggle {
      position: absolute;
      left: 20px;
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
    }

    .tab {
      display: none;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .tab.active {
      display: block;
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
    }

    .stat-number {
      font-size: 2em;
      font-weight: bold;
      color: var(--primary-color);
    }

    .form-section {
      background: var(--card-bg);
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 5px;
      background: var(--card-bg);
      color: var(--text-color);
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--secondary-color);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card-bg);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    th, td {
      padding: 10px;
      text-align: right;
      border-bottom: 1px solid var(--border-color);
    }

    th {
      background: var(--primary-color);
      color: white;
      font-weight: 600;
    }

    tr:hover {
      background: rgba(76, 175, 80, 0.1);
    }

    .btn {
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      margin: 2px;
      transition: all 0.3s ease;
    }

    .btn:hover {
      opacity: 0.8;
    }

    .btn-primary { background: var(--secondary-color); color: white; }
    .btn-success { background: var(--success-color); color: white; }
    .btn-warning { background: var(--warning-color); color: white; }
    .btn-danger { background: var(--danger-color); color: white; }
    .btn-secondary { background: #6c757d; color: white; }

    .paid { background-color: rgba(76, 175, 80, 0.1); }
    .unpaid { background-color: rgba(244, 67, 54, 0.1); }
    .overdue { background-color: rgba(255, 152, 0, 0.2); }

    .search-filter {
      background: var(--card-bg);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background-color: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--success-color);
      transition: width 0.3s ease;
    }

    .rating {
      display: inline-block;
    }

    .rating span {
      color: #ffa500;
      font-size: 16px;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      background: var(--border-color);
      border-radius: 10px;
      overflow: hidden;
    }

    .calendar-day {
      background: var(--card-bg);
      padding: 8px;
      min-height: 60px;
      position: relative;
      font-size: 12px;
    }

    .calendar-lesson {
      background: var(--primary-color);
      color: white;
      padding: 2px 4px;
      border-radius: 3px;
      font-size: 10px;
      margin: 1px 0;
      cursor: pointer;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 5px;
      color: white;
      z-index: 1001;
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success { background: var(--success-color); }
    .notification.error { background: var(--danger-color); }
    .notification.warning { background: var(--warning-color); }

    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .dashboard {
        grid-template-columns: 1fr;
      }
      
      nav {
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body data-theme="light">

<nav>
  <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“</button>
  <button onclick="showTab('dashboard')">×“×©×‘×•×¨×“</button>
  <button onclick="showTab('students')">× ×™×”×•×œ ×ª×œ××™×“×™×</button>
  <button onclick="showTab('lessons')">××¢×§×‘ ×©×™×¢×•×¨×™×</button>
  <button onclick="showTab('calendar')">×™×•××Ÿ</button>
  <button onclick="showTab('payments')">×ª×©×œ×•××™×</button>
  <button onclick="showTab('reports')">×“×•×—×•×ª</button>
</nav>

<!-- ×“×©×‘×•×¨×“ -->
<div id="dashboard" class="tab active">
  <h2>×“×©×‘×•×¨×“ ×¨××©×™</h2>
  <div class="dashboard" id="dashboardStats"></div>
  
  <div class="form-section">
    <h3>×¤×¢×™×œ×•×ª ××—×¨×•× ×”</h3>
    <div id="recentActivity"></div>
  </div>
</div>

<!-- × ×™×”×•×œ ×ª×œ××™×“×™× -->
<div id="students" class="tab">
  <div class="search-filter">
    <input type="text" id="studentSearch" placeholder="×—×¤×© ×ª×œ××™×“..." onkeyup="filterStudents()">
  </div>
  
  <div class="form-section">
    <h3>×”×•×¡×£/×¢×¨×•×š ×ª×œ××™×“</h3>
    <div class="form-row">
      <div>
        <label>×©× ×ª×œ××™×“:</label>
        <input type="text" id="studentName">
      </div>
      <div>
        <label>×’×™×œ:</label>
        <input type="number" id="studentAge">
      </div>
      <div>
        <label>×›×™×ª×”:</label>
        <input type="text" id="studentClass">
      </div>
    </div>
    <div class="form-row">
      <div>
        <label>××—×™×¨ ×©×™×¢×•×¨ (×‘×¨×™×¨×ª ××—×“×œ):</label>
        <input type="number" id="studentPrice" value="100">
      </div>
      <div>
        <label>××—×•×– ×”× ×—×”:</label>
        <input type="number" id="studentDiscount" value="0" min="0" max="100">
      </div>
      <div>
        <label>×˜×œ×¤×•×Ÿ:</label>
        <input type="tel" id="studentPhone">
      </div>
    </div>
    <button class="btn btn-success" onclick="addStudent()">×©××•×¨</button>
    <button class="btn btn-warning" onclick="cancelStudentEdit()" id="cancelStudentBtn" style="display:none;">×‘×™×˜×•×œ</button>
  </div>
  
  <div class="form-section">
    <table id="studentTable"></table>
  </div>
</div>

<!-- ××¢×§×‘ ×©×™×¢×•×¨×™× -->
<div id="lessons" class="tab">
  <div class="search-filter">
    <div class="form-row">
      <div>
        <input type="text" id="lessonSearch" placeholder="×—×¤×© ×©×™×¢×•×¨..." onkeyup="filterLessons()">
      </div>
      <div>
        <select id="lessonFilter" onchange="filterLessons()">
          <option value="">×›×œ ×”×©×™×¢×•×¨×™×</option>
          <option value="paid">×©×•×œ××•</option>
          <option value="unpaid">×œ× ×©×•×œ××•</option>
          <option value="overdue">×‘××™×—×•×¨</option>
        </select>
      </div>
    </div>
  </div>
  
  <div class="form-section">
    <h3 id="lessonFormTitle">×”×•×¡×£ ×©×™×¢×•×¨</h3>
    <div class="form-row">
      <div>
        <label>×‘×—×¨ ×ª×œ××™×“:</label>
        <select id="lessonStudent" onchange="updateLessonPrice(); refreshLessonView();">
          <option value="">×‘×—×¨</option>
        </select>
      </div>
      <div>
        <label>× ×•×©× ×”×©×™×¢×•×¨:</label>
        <input type="text" id="lessonTopic">
      </div>
      <div>
        <label>×ª××¨×™×š:</label>
        <input type="date" id="lessonDate">
      </div>
    </div>
    <div class="form-row">
      <div>
        <label>×©×¢×ª ×”×ª×—×œ×”:</label>
        <input type="time" id="lessonTime">
      </div>
      <div>
        <label>××©×š ×”×©×™×¢×•×¨ (×“×§×•×ª):</label>
        <input type="number" id="lessonDuration" value="60">
      </div>
      <div>
        <label>×¢×œ×•×ª:</label>
        <input type="number" id="lessonCost" value="0">
      </div>
    </div>
    <div class="form-row">
      <div>
        <label>×“×™×¨×•×’ (1-5):</label>
        <select id="lessonRating">
          <option value="">×‘×—×¨ ×“×™×¨×•×’</option>
          <option value="1">1 â­</option>
          <option value="2">2 â­â­</option>
          <option value="3">3 â­â­â­</option>
          <option value="4">4 â­â­â­â­</option>
          <option value="5">5 â­â­â­â­â­</option>
        </select>
      </div>
      <div>
        <label>
          <input type="checkbox" id="lessonPaid"> ×©×•×œ×
        </label>
      </div>
    </div>
    <div>
      <label>×”×¢×¨×•×ª:</label>
      <textarea id="lessonNotes" rows="3"></textarea>
    </div>
    <button class="btn btn-success" onclick="addLesson()" id="saveLessonBtn">×©××•×¨</button>
    <button class="btn btn-warning" onclick="cancelLessonEdit()" id="cancelLessonBtn" style="display:none;">×‘×™×˜×•×œ</button>
  </div>
  
  <div id="lessonList"></div>
</div>

<!-- ×™×•××Ÿ -->
<div id="calendar" class="tab">
  <div class="form-section">
    <h3>×™×•××Ÿ ×©×™×¢×•×¨×™×</h3>
    <div style="text-align: center; margin: 20px 0;">
      <button class="btn btn-primary" onclick="changeMonth(-1)">â† ×—×•×“×© ×§×•×“×</button>
      <span id="currentMonth" style="margin: 0 20px; font-weight: bold; font-size: 18px;"></span>
      <button class="btn btn-primary" onclick="changeMonth(1)">×—×•×“×© ×”×‘× â†’</button>
    </div>
  </div>
  
  <div class="form-section">
    <div id="calendarView" class="calendar"></div>
  </div>
</div>

<!-- ×ª×©×œ×•××™× -->
<div id="payments" class="tab">
  <div class="form-section">
    <h3>×ª×©×œ×•××™× ×œ×¤×™ ×ª×œ××™×“</h3>
    <select id="paymentStudent" onchange="refreshPaymentView()">
      <option value="">×‘×—×¨</option>
    </select>
    <div id="paymentSummary"></div>
  </div>
  
  <div class="form-section">
    <h3>×¡×™×›×•× ×›×œ×›×œ×™</h3>
    <div id="financialSummary"></div>
  </div>
</div>

<!-- ×“×•×—×•×ª -->
<div id="reports" class="tab">
  <div style="text-align: center; margin: 20px 0;">
    <button class="btn btn-primary" onclick="exportToCSV()">×™×™×¦× ×œ-CSV</button>
    <button class="btn btn-success" onclick="printReport()">×”×“×¤×¡ ×“×•×—</button>
    <button class="btn btn-warning" onclick="backupData()">×’×‘×” × ×ª×•× ×™×</button>
    <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importData(event)">
    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">×™×™×‘× × ×ª×•× ×™×</button>
    <button class="btn btn-danger" onclick="resetAllData()">××—×§ ×”×›×œ</button>
  </div>
  
  <div class="form-section">
    <h3>×“×•×— ××¤×•×¨×˜ ×œ×ª×œ××™×“</h3>
    <select id="reportStudent" onchange="refreshReportView()">
      <option value="">×‘×—×¨</option>
    </select>
    <div id="reportData"></div>
  </div>
</div>

<script>
// ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
let students = [];
let lessons = [];
let currentEditingStudent = null;
let currentEditingLesson = null;
let currentDate = new Date();

// ×˜×¢×™× ×” ×¨××©×•× ×™×ª
window.onload = function() {
  loadData(); // ×˜×¢×Ÿ × ×ª×•× ×™× ×§×•×“×
  initSampleData(); // ×¨×§ ×× ××™×Ÿ × ×ª×•× ×™× ×©××•×¨×™×
  renderDashboard();
  renderCalendar();
};

// ××¢×‘×¨ ×‘×™×Ÿ ×˜××‘×™×
function showTab(tabId) {
  document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
  document.getElementById(tabId).classList.add("active");
  
  if (tabId === 'dashboard') renderDashboard();
  if (tabId === 'calendar') renderCalendar();
  if (tabId === 'payments') refreshFinancialSummary();
}

// × ×•×©× ×›×”×”/×‘×”×™×¨
function toggleTheme() {
  const body = document.body;
  const currentTheme = body.getAttribute('data-theme');
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  body.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
}

// ×”×•×“×¢×•×ª
function showNotification(message, type = 'success') {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.textContent = message;
  document.body.appendChild(notification);
  
  setTimeout(() => notification.classList.add('show'), 100);
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => {
      if (document.body.contains(notification)) {
        document.body.removeChild(notification);
      }
    }, 300);
  }, 3000);
}

// ×©××™×¨×” ×•×˜×¢×™× ×”
function saveData() {
  try {
    const data = {
      students: students,
      lessons: lessons,
      lastUpdated: new Date().toISOString()
    };
    localStorage.setItem('lessonTrackerData', JSON.stringify(data));
    console.log("× ×ª×•× ×™× × ×©××¨×• ×‘×”×¦×œ×—×”");
  } catch (error) {
    console.error("×©×’×™××” ×‘×©××™×¨×ª × ×ª×•× ×™×:", error);
    showNotification("×©×’×™××” ×‘×©××™×¨×ª × ×ª×•× ×™×", "error");
  }
}

function loadData() {
  try {
    const savedData = localStorage.getItem('lessonTrackerData');
    if (savedData) {
      const data = JSON.parse(savedData);
      if (data.students && data.lessons) {
        students = data.students;
        lessons = data.lessons;
        console.log("× ×ª×•× ×™× × ×˜×¢× ×• ××”×–×™×›×¨×•×Ÿ");
        showNotification("× ×ª×•× ×™× × ×˜×¢× ×• ×‘×”×¦×œ×—×”", "success");
      }
    }
    
    // ×˜×¢×Ÿ × ×•×©× ×©××•×¨
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      document.body.setAttribute('data-theme', savedTheme);
    }
  } catch (error) {
    console.error("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×:", error);
    showNotification("×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×", "error");
  }
  
  renderStudents();
  populateSelects();
}

// ××ª×—×•×œ × ×ª×•× ×™× ×œ×“×•×’××”
function initSampleData() {
  // ×¨×§ ×× ××™×Ÿ × ×ª×•× ×™× ×©××•×¨×™×, × ×˜×¢×Ÿ × ×ª×•× ×™ ×“×•×’××”
  const savedData = localStorage.getItem('lessonTrackerData');
  if (!savedData && students.length === 0) {
    students = [
      { name: '×™×•×¡×™ ×›×”×Ÿ', age: 15, class: '×™"×', price: 120, discount: 10, phone: '050-1234567' },
      { name: '×©×¨×” ×œ×•×™', age: 14, class: '×˜"×•', price: 100, discount: 0, phone: '052-9876543' },
      { name: '×“× ×™ ××©×”', age: 16, class: '×™"×‘', price: 150, discount: 5, phone: '054-5555555' }
    ];
    
    lessons = [
      {
        id: 1,
        studentName: '×™×•×¡×™ ×›×”×Ÿ',
        topic: '××œ×’×‘×¨×”',
        date: '2025-07-25',
        time: '16:00',
        duration: 60,
        cost: 108,
        paid: true,
        rating: 4,
        notes: '×”×ª×§×“××•×ª ×˜×•×‘×”'
      },
      {
        id: 2,
        studentName: '×©×¨×” ×œ×•×™',
        topic: '×’×™××•××˜×¨×™×”',
        date: '2025-07-28',
        time: '17:30',
        duration: 90,
        cost: 100,
        paid: false,
        rating: 5,
        notes: '××¦×•×™× ×ª!'
      },
      {
        id: 3,
        studentName: '×“× ×™ ××©×”',
        topic: '×—×©×‘×•×Ÿ ×“×™×¤×¨× ×¦×™××œ×™',
        date: '2025-08-01',
        time: '14:00',
        duration: 60,
        cost: 142,
        paid: true,
        rating: 3,
        notes: '×¦×¨×™×š ×œ×”×ª×¨×’×œ ×™×•×ª×¨'
      }
    ];
    
    // ×©××•×¨ ××ª × ×ª×•× ×™ ×”×“×•×’××”
    saveData();
    showNotification('× ×ª×•× ×™ ×“×•×’××” × ×˜×¢× ×• ×•× ×©××¨×•', 'success');
  }
}

// ×“×©×‘×•×¨×“
function renderDashboard() {
  const totalStudents = students.length;
  const totalLessons = lessons.length;
  const totalIncome = lessons.reduce((sum, l) => sum + (l.paid ? l.cost : 0), 0);
  const pendingPayments = lessons.reduce((sum, l) => sum + (!l.paid ? l.cost : 0), 0);
  const avgRating = lessons.filter(l => l.rating).length > 0 
    ? (lessons.filter(l => l.rating).reduce((sum, l) => sum + l.rating, 0) / lessons.filter(l => l.rating).length).toFixed(1)
    : 'N/A';

  const statsHTML = `
    <div class="stat-card">
      <div class="stat-number">${totalStudents}</div>
      <div>×ª×œ××™×“×™× ×¤×¢×™×œ×™×</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">${totalLessons}</div>
      <div>×¡×”"×› ×©×™×¢×•×¨×™×</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">${totalIncome}â‚ª</div>
      <div>×”×›× ×¡×•×ª</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">${pendingPayments}â‚ª</div>
      <div>×××ª×™×Ÿ ×œ×ª×©×œ×•×</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">${avgRating}</div>
      <div>×“×™×¨×•×’ ×××•×¦×¢</div>
    </div>
  `;
  
  document.getElementById('dashboardStats').innerHTML = statsHTML;
  
  // ×¤×¢×™×œ×•×ª ××—×¨×•× ×”
  const recentLessons = lessons.slice(-5).reverse();
  const recentHTML = recentLessons.map(l => 
    `<div style="padding: 10px; border-bottom: 1px solid var(--border-color);">
      <strong>${l.studentName}</strong> - ${l.topic} (${l.date})
      <span style="float: left; color: ${l.paid ? 'green' : 'red'}">
        ${l.paid ? 'âœ” ×©×•×œ×' : 'âŒ ×œ× ×©×•×œ×'}
      </span>
    </div>`
  ).join('');
  
  document.getElementById('recentActivity').innerHTML = recentHTML || '<p>××™×Ÿ ×¤×¢×™×œ×•×ª ×¢×“×™×™×Ÿ</p>';
}

// × ×™×”×•×œ ×ª×œ××™×“×™×
function populateSelects() {
  const selectors = ['lessonStudent', 'paymentStudent', 'reportStudent'];
  selectors.forEach(id => {
    const select = document.getElementById(id);
    if (select) {
      select.innerHTML = '<option value="">×‘×—×¨</option>';
      students.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s.name;
        opt.textContent = s.name;
        select.appendChild(opt);
      });
    }
  });
}

function filterStudents() {
  const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
  const rows = document.querySelectorAll('#studentTable tr:not(:first-child)');
  
  rows.forEach(row => {
    const text = row.textContent.toLowerCase();
    row.style.display = text.includes(searchTerm) ? '' : 'none';
  });
}

function addStudent() {
  const name = document.getElementById("studentName").value.trim();
  const age = document.getElementById("studentAge").value;
  const studentClass = document.getElementById("studentClass").value.trim();
  const price = Number(document.getElementById("studentPrice").value) || 100;
  const discount = Number(document.getElementById("studentDiscount").value) || 0;
  const phone = document.getElementById("studentPhone").value.trim();
  
  if (!name) {
    showNotification("×™×© ×œ×”×–×™×Ÿ ×©× ×ª×œ××™×“", "error");
    return;
  }
  
  if (currentEditingStudent) {
    currentEditingStudent.name = name;
    currentEditingStudent.age = age;
    currentEditingStudent.class = studentClass;
    currentEditingStudent.price = price;
    currentEditingStudent.discount = discount;
    currentEditingStudent.phone = phone;
    currentEditingStudent = null;
    document.getElementById("cancelStudentBtn").style.display = "none";
    showNotification("×ª×œ××™×“ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”");
  } else {
    const existing = students.find(s => s.name === name);
    if (existing) {
      existing.age = age;
      existing.class = studentClass;
      existing.price = price;
      existing.discount = discount;
      existing.phone = phone;
      showNotification("×¤×¨×˜×™ ×ª×œ××™×“ ×¢×•×“×›× ×•");
    } else {
      students.push({ name, age, class: studentClass, price, discount, phone });
      showNotification("×ª×œ××™×“ × ×•×¡×£ ×‘×”×¦×œ×—×”");
    }
  }
  
  saveData();
  renderStudents();
  populateSelects();
  clearStudentForm();
  renderDashboard();
}

function renderStudents() {
  const table = document.getElementById("studentTable");
  table.innerHTML = `
    <tr>
      <th>×©×</th>
      <th>×’×™×œ</th>
      <th>×›×™×ª×”</th>
      <th>××—×™×¨ ×‘×¨×™×¨×ª ××—×“×œ</th>
      <th>×”× ×—×”</th>
      <th>×˜×œ×¤×•×Ÿ</th>
      <th>×¤×¢×•×œ×•×ª</th>
    </tr>`;
    
  students.forEach(s => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${s.name}</td>
      <td>${s.age}</td>
      <td>${s.class}</td>
      <td>${s.price}â‚ª</td>
      <td>${s.discount}%</td>
      <td>${s.phone || ''}</td>
      <td>
        <button class="btn btn-primary" onclick="editStudent('${s.name}')">×¢×¨×•×š</button>
        <button class="btn btn-danger" onclick="deleteStudent('${s.name}')">××—×§</button>
      </td>`;
    table.appendChild(tr);
  });
}

function editStudent(name) {
  const s = students.find(st => st.name === name);
  if (!s) return;
  
  currentEditingStudent = s;
  document.getElementById("studentName").value = s.name;
  document.getElementById("studentAge").value = s.age;
  document.getElementById("studentClass").value = s.class;
  document.getElementById("studentPrice").value = s.price;
  document.getElementById("studentDiscount").value = s.discount || 0;
  document.getElementById("studentPhone").value = s.phone || '';
  document.getElementById("cancelStudentBtn").style.display = "inline-block";
}

function deleteStudent(name) {
  if (!confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×ª×œ××™×“? ×›×œ ×”×©×™×¢×•×¨×™× ×©×œ×• ×™×™××—×§×• ×’× ×›×Ÿ.")) return;
  
  students = students.filter(s => s.name !== name);
  lessons = lessons.filter(l => l.studentName !== name);
  saveData();
  renderStudents();
  populateSelects();
  refreshLessonView();
  refreshPaymentView();
  refreshReportView();
  renderDashboard();
  showNotification("×ª×œ××™×“ × ××—×§", "warning");
}

function clearStudentForm() {
  document.getElementById("studentName").value = "";
  document.getElementById("studentAge").value = "";
  document.getElementById("studentClass").value = "";
  document.getElementById("studentPrice").value = "100";
  document.getElementById("studentDiscount").value = "0";
  document.getElementById("studentPhone").value = "";
}

function cancelStudentEdit() {
  currentEditingStudent = null;
  document.getElementById("cancelStudentBtn").style.display = "none";
  clearStudentForm();
}

// × ×™×”×•×œ ×©×™×¢×•×¨×™×
function updateLessonPrice() {
  const studentName = document.getElementById("lessonStudent").value;
  if (studentName) {
    const student = students.find(s => s.name === studentName);
    if (student) {
      const price = student.price || 100;
      const discount = student.discount || 0;
      const finalPrice = price * (1 - discount / 100);
      document.getElementById("lessonCost").value = Math.round(finalPrice);
    }
  }
}

function filterLessons() {
  const searchTerm = document.getElementById('lessonSearch').value.toLowerCase();
  const filter = document.getElementById('lessonFilter').value;
  const rows = document.querySelectorAll('#lessonList table tr:not(:first-child)');
  
  rows.forEach(row => {
    if (!row.dataset.lesson) return;
    
    const lesson = JSON.parse(row.dataset.lesson);
    const text = row.textContent.toLowerCase();
    
    let show = text.includes(searchTerm);
    
    if (filter && show) {
      if (filter === 'paid' && !lesson.paid) show = false;
      if (filter === 'unpaid' && lesson.paid) show = false;
      if (filter === 'overdue' && (lesson.paid || !isOverdue(lesson.date))) show = false;
    }
    
    row.style.display = show ? '' : 'none';
  });
}

function isOverdue(dateStr) {
  const lessonDate = new Date(dateStr);
  const today = new Date();
  const diffDays = (today - lessonDate) / (1000 * 60 * 60 * 24);
  return diffDays > 30; // ×©×™×¢×•×¨ × ×—×©×‘ ×‘××™×—×•×¨ ××—×¨×™ 30 ×™×•×
}

function generateLessonId() {
  return Date.now() + Math.random();
}

function addLesson() {
  const studentName = document.getElementById("lessonStudent").value;
  if (!studentName) {
    showNotification("×™×© ×œ×‘×—×•×¨ ×ª×œ××™×“", "error");
    return;
  }
  
  const topic = document.getElementById("lessonTopic").value.trim();
  const date = document.getElementById("lessonDate").value;
  const time = document.getElementById("lessonTime").value;
  const duration = Number(document.getElementById("lessonDuration").value) || 60;
  const notes = document.getElementById("lessonNotes").value.trim();
  const cost = Number(document.getElementById("lessonCost").value);
  const paid = document.getElementById("lessonPaid").checked;
  const rating = document.getElementById("lessonRating").value ? Number(document.getElementById("lessonRating").value) : null;
  
  if (!topic) {
    showNotification("×™×© ×œ×”×–×™×Ÿ × ×•×©× ×©×™×¢×•×¨", "error");
    return;
  }
  
  if (!date) {
    showNotification("×™×© ×œ×”×–×™×Ÿ ×ª××¨×™×š", "error");
    return;
  }
  
  if (currentEditingLesson) {
    currentEditingLesson.studentName = studentName;
    currentEditingLesson.topic = topic;
    currentEditingLesson.date = date;
    currentEditingLesson.time = time;
    currentEditingLesson.duration = duration;
    currentEditingLesson.notes = notes;
    currentEditingLesson.cost = cost;
    currentEditingLesson.paid = paid;
    currentEditingLesson.rating = rating;
    currentEditingLesson = null;
    
    document.getElementById("cancelLessonBtn").style.display = "none";
    document.getElementById("lessonFormTitle").textContent = "×”×•×¡×£ ×©×™×¢×•×¨";
    document.getElementById("saveLessonBtn").textContent = "×©××•×¨";
    showNotification("×©×™×¢×•×¨ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”");
  } else {
    lessons.push({ 
      id: generateLessonId(),
      studentName, 
      topic, 
      date,
      time,
      duration,
      notes, 
      cost, 
      paid,
      rating
    });
    showNotification("×©×™×¢×•×¨ × ×•×¡×£ ×‘×”×¦×œ×—×”");
  }
  
  saveData();
  refreshLessonView();
  refreshPaymentView();
  refreshReportView();
  renderDashboard();
  renderCalendar();
  clearLessonForm();
}

function clearLessonForm() {
  document.getElementById("lessonTopic").value = "";
  document.getElementById("lessonDate").value = "";
  document.getElementById("lessonTime").value = "";
  document.getElementById("lessonDuration").value = "60";
  document.getElementById("lessonNotes").value = "";
  document.getElementById("lessonCost").value = "0";
  document.getElementById("lessonPaid").checked = false;
  document.getElementById("lessonRating").value = "";
}

function cancelLessonEdit() {
  currentEditingLesson = null;
  document.getElementById("cancelLessonBtn").style.display = "none";
  document.getElementById("lessonFormTitle").textContent = "×”×•×¡×£ ×©×™×¢×•×¨";
  document.getElementById("saveLessonBtn").textContent = "×©××•×¨";
  clearLessonForm();
}

function editLesson(lessonId) {
  const lesson = lessons.find(l => l.id === lessonId);
  if (!lesson) return;
  
  currentEditingLesson = lesson;
  document.getElementById("lessonStudent").value = lesson.studentName;
  document.getElementById("lessonTopic").value = lesson.topic;
  document.getElementById("lessonDate").value = lesson.date;
  document.getElementById("lessonTime").value = lesson.time || '';
  document.getElementById("lessonDuration").value = lesson.duration || 60;
  document.getElementById("lessonNotes").value = lesson.notes;
  document.getElementById("lessonCost").value = lesson.cost;
  document.getElementById("lessonPaid").checked = lesson.paid;
  document.getElementById("lessonRating").value = lesson.rating || '';
  
  document.getElementById("cancelLessonBtn").style.display = "inline-block";
  document.getElementById("lessonFormTitle").textContent = "×¢×¨×•×š ×©×™×¢×•×¨";
  document.getElementById("saveLessonBtn").textContent = "×¢×“×›×Ÿ";
  
  document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
}

function deleteLesson(lessonId) {
  if (!confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×©×™×¢×•×¨?")) return;
  
  lessons = lessons.filter(l => l.id !== lessonId);
  saveData();
  refreshLessonView();
  refreshPaymentView();
  refreshReportView();
  renderDashboard();
  renderCalendar();
  showNotification("×©×™×¢×•×¨ × ××—×§", "warning");
}

function togglePayment(lessonId) {
  const lesson = lessons.find(l => l.id === lessonId);
  if (lesson) {
    lesson.paid = !lesson.paid;
    saveData();
    refreshLessonView();
    refreshPaymentView();
    refreshReportView();
    renderDashboard();
    showNotification(lesson.paid ? "×¡×•××Ÿ ×›×©×•×œ×" : "×‘×•×˜×œ ×¡×™××•×Ÿ ×ª×©×œ×•×");
  }
}

function refreshLessonView() {
  const studentName = document.getElementById("lessonStudent").value;
  const container = document.getElementById("lessonList");
  container.innerHTML = "";
  
  if (!studentName) return;
  
  const list = lessons.filter(l => l.studentName === studentName);
  if (list.length === 0) {
    container.innerHTML = "<p>××™×Ÿ ×©×™×¢×•×¨×™×</p>";
    return;
  }
  
  const table = document.createElement("table");
  table.innerHTML = `
    <tr>
      <th>× ×•×©×</th>
      <th>×ª××¨×™×š</th>
      <th>×©×¢×”</th>
      <th>××©×š</th>
      <th>×”×¢×¨×•×ª</th>
      <th>×¢×œ×•×ª</th>
      <th>×“×™×¨×•×’</th>
      <th>×¡×˜×˜×•×¡</th>
      <th>×¤×¢×•×œ×•×ª</th>
    </tr>`;
  
  list.forEach(l => {
    const tr = document.createElement("tr");
    const overdue = !l.paid && isOverdue(l.date);
    tr.className = l.paid ? 'paid' : (overdue ? 'overdue' : 'unpaid');
    tr.dataset.lesson = JSON.stringify(l);
    
    const ratingStars = l.rating ? 'â­'.repeat(l.rating) : '×œ× ×“×•×¨×’';
    
    tr.innerHTML = `
      <td>${l.topic}</td>
      <td>${l.date}</td>
      <td>${l.time || ''}</td>
      <td>${l.duration || 60} ×“×§'</td>
      <td>${l.notes}</td>
      <td>${l.cost}â‚ª</td>
      <td>${ratingStars}</td>
      <td>${l.paid ? "âœ” ×©×•×œ×" : (overdue ? "â° ×‘××™×—×•×¨" : "âŒ ×œ× ×©×•×œ×")}</td>
      <td>
        <button class="btn btn-primary" onclick="editLesson(${l.id})">×¢×¨×•×š</button>
        <button class="btn btn-warning" onclick="togglePayment(${l.id})">
          ${l.paid ? "×‘×˜×œ ×ª×©×œ×•×" : "×¡××Ÿ ×›×©×•×œ×"}
        </button>
        <button class="btn btn-danger" onclick="deleteLesson(${l.id})">××—×§</button>
      </td>`;
    table.appendChild(tr);
  });
  container.appendChild(table);
}

// ×™×•××Ÿ
function renderCalendar() {
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  
  document.getElementById('currentMonth').textContent = 
    new Date(year, month).toLocaleDateString('he-IL', { year: 'numeric', month: 'long' });
  
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  const startDate = new Date(firstDay);
  startDate.setDate(startDate.getDate() - firstDay.getDay());
  
  const calendar = document.getElementById('calendarView');
  calendar.innerHTML = '';
  
  // ×›×•×ª×¨×•×ª ×™××™ ×”×©×‘×•×¢
  const dayHeaders = ['×¨××©', '×©× ×™', '×©×œ×™', '×¨×‘×™', '×—××™', '×©×™×©', '×©×‘×ª'];
  dayHeaders.forEach(day => {
    const dayHeader = document.createElement('div');
    dayHeader.className = 'calendar-day';
    dayHeader.innerHTML = `<strong>${day}</strong>`;
    dayHeader.style.background = 'var(--primary-color)';
    dayHeader.style.color = 'white';
    dayHeader.style.textAlign = 'center';
    calendar.appendChild(dayHeader);
  });
  
  // ×™××™ ×”×—×•×“×©
  for (let i = 0; i < 42; i++) {
    const date = new Date(startDate);
    date.setDate(startDate.getDate() + i);
    
    const dayElement = document.createElement('div');
    dayElement.className = 'calendar-day';
    
    const isCurrentMonth = date.getMonth() === month;
    if (!isCurrentMonth) {
      dayElement.style.opacity = '0.3';
    }
    
    const dateStr = date.toISOString().split('T')[0];
    const dayLessons = lessons.filter(l => l.date === dateStr);
    
    dayElement.innerHTML = `
      <div style="font-weight: bold; margin-bottom: 3px;">${date.getDate()}</div>
      ${dayLessons.map(l => 
        `<div class="calendar-lesson" title="${l.studentName} - ${l.topic}">
          ${l.time || ''} ${l.studentName.split(' ')[0]}
        </div>`
      ).join('')}
    `;
    
    calendar.appendChild(dayElement);
  }
}

function changeMonth(direction) {
  currentDate.setMonth(currentDate.getMonth() + direction);
  renderCalendar();
}

// ×ª×©×œ×•××™×
function refreshPaymentView() {
  const studentName = document.getElementById("paymentStudent").value;
  const div = document.getElementById("paymentSummary");
  div.innerHTML = "";
  
  if (!studentName) return;
  
  const list = lessons.filter(l => l.studentName === studentName);
  const total = list.reduce((sum, l) => sum + l.cost, 0);
  const paid = list.filter(l => l.paid).reduce((sum, l) => sum + l.cost, 0);
  const unpaid = total - paid;
  const count = list.length;
  const paidCount = list.filter(l => l.paid).length;
  
  const progressPercent = total > 0 ? (paid / total) * 100 : 0;
  
  div.innerHTML = `
    <div style="background: var(--card-bg); padding: 20px; border-radius: 10px; margin-top: 15px;">
      <h4>×¡×™×›×•× ×ª×©×œ×•××™× - ${studentName}</h4>
      <div class="progress-bar">
        <div class="progress-fill" style="width: ${progressPercent}%"></div>
      </div>
      <p><strong>×¡×”"×› ×©×™×¢×•×¨×™×:</strong> ${count} (×©×•×œ××•: ${paidCount})</p>
      <p><strong>×¡×”"×› ×œ×ª×©×œ×•×:</strong> ${total}â‚ª</p>
      <p><strong>×©×•×œ×:</strong> ${paid}â‚ª</p>
      <p><strong>× ×•×ª×¨ ×œ×ª×©×œ×•×:</strong> ${unpaid}â‚ª</p>
      <p><strong>××—×•×– ×ª×©×œ×•×:</strong> ${progressPercent.toFixed(1)}%</p>
    </div>`;
}

function refreshFinancialSummary() {
  const thisMonth = new Date().toISOString().slice(0, 7);
  const thisMonthLessons = lessons.filter(l => l.date.startsWith(thisMonth));
  const monthlyIncome = thisMonthLessons.reduce((sum, l) => sum + (l.paid ? l.cost : 0), 0);
  const monthlyPending = thisMonthLessons.reduce((sum, l) => sum + (!l.paid ? l.cost : 0), 0);
  
  const totalIncome = lessons.reduce((sum, l) => sum + (l.paid ? l.cost : 0), 0);
  const totalPending = lessons.reduce((sum, l) => sum + (!l.paid ? l.cost : 0), 0);
  
  const overduePayments = lessons.filter(l => !l.paid && isOverdue(l.date));
  const overdueAmount = overduePayments.reduce((sum, l) => sum + l.cost, 0);
  
  document.getElementById('financialSummary').innerHTML = `
    <div class="dashboard">
      <div class="stat-card">
        <div class="stat-number">${monthlyIncome}â‚ª</div>
        <div>×”×›× ×¡×•×ª ×”×—×•×“×©</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">${monthlyPending}â‚ª</div>
        <div>×××ª×™×Ÿ ×”×—×•×“×©</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">${totalIncome}â‚ª</div>
        <div>×¡×”"×› ×”×›× ×¡×•×ª</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" style="color: var(--danger-color);">${overdueAmount}â‚ª</div>
        <div>×ª×©×œ×•××™× ×‘××™×—×•×¨ (${overduePayments.length})</div>
      </div>
    </div>
  `;
}

// ×“×•×—×•×ª
function refreshReportView() {
  const studentName = document.getElementById("reportStudent").value;
  const div = document.getElementById("reportData");
  div.innerHTML = "";
  
  if (!studentName) return;
  
  const list = lessons.filter(l => l.studentName === studentName);
  if (list.length === 0) {
    div.innerHTML = "<p>××™×Ÿ × ×ª×•× ×™× ×œ×”×¦×’×”</p>";
    return;
  }
  
  const student = students.find(s => s.name === studentName);
  const avgRating = list.filter(l => l.rating).length > 0
    ? (list.filter(l => l.rating).reduce((sum, l) => sum + l.rating, 0) / list.filter(l => l.rating).length).toFixed(1)
    : '×œ× ×“×•×¨×’';
  
  const summaryHTML = `
    <div class="stat-card" style="margin-bottom: 20px; text-align: right;">
      <h4>×¡×™×›×•× ×›×œ×œ×™ - ${studentName}</h4>
      <p><strong>×’×™×œ:</strong> ${student?.age || '×œ× ×¦×•×™×Ÿ'}</p>
      <p><strong>×›×™×ª×”:</strong> ${student?.class || '×œ× ×¦×•×™×Ÿ'}</p>
      <p><strong>×˜×œ×¤×•×Ÿ:</strong> ${student?.phone || '×œ× ×¦×•×™×Ÿ'}</p>
      <p><strong>×¡×”"×› ×©×™×¢×•×¨×™×:</strong> ${list.length}</p>
      <p><strong>×“×™×¨×•×’ ×××•×¦×¢:</strong> ${avgRating === '×œ× ×“×•×¨×’' ? avgRating : avgRating + ' â­'}</p>
      <p><strong>×©×™×¢×•×¨ ××—×¨×•×Ÿ:</strong> ${list[list.length-1]?.date || '××™×Ÿ'}</p>
    </div>
  `;
  
  const table = document.createElement("table");
  table.innerHTML = `
    <tr>
      <th>× ×•×©×</th>
      <th>×ª××¨×™×š</th>
      <th>×©×¢×”</th>
      <th>×”×¢×¨×•×ª</th>
      <th>×¢×œ×•×ª</th>
      <th>×“×™×¨×•×’</th>
      <th>×¡×˜×˜×•×¡</th>
    </tr>`;
  
  list.forEach(l => {
    const tr = document.createElement("tr");
    tr.className = l.paid ? 'paid' : (isOverdue(l.date) ? 'overdue' : 'unpaid');
    tr.innerHTML = `
      <td>${l.topic}</td>
      <td>${l.date}</td>
      <td>${l.time || ''}</td>
      <td>${l.notes}</td>
      <td>${l.cost}â‚ª</td>
      <td>${l.rating ? 'â­'.repeat(l.rating) : '×œ× ×“×•×¨×’'}</td>
      <td>${l.paid ? "âœ” ×©×•×œ×" : (isOverdue(l.date) ? "â° ×‘××™×—×•×¨" : "âŒ ×œ× ×©×•×œ×")}</td>`;
    table.appendChild(tr);
  });
  
  div.innerHTML = summaryHTML;
  div.appendChild(table);
}

// ×™×™×¦×•× ×•××™×¦×•×
function exportToCSV() {
  const csvContent = [
    ['×ª×œ××™×“', '× ×•×©×', '×ª××¨×™×š', '×©×¢×”', '×¢×œ×•×ª', '×©×•×œ×', '×“×™×¨×•×’', '×”×¢×¨×•×ª'],
    ...lessons.map(l => [
      l.studentName,
      l.topic,
      l.date,
      l.time || '',
      l.cost,
      l.paid ? '×›×Ÿ' : '×œ×',
      l.rating || '',
      l.notes
    ])
  ].map(row => row.join(',')).join('\n');
  
  const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = `lessons_report_${new Date().toISOString().slice(0, 10)}.csv`;
  link.click();
  
  showNotification('×“×•×— ×™×•×¦× ×‘×”×¦×œ×—×”');
}

function printReport() {
  const studentName = document.getElementById("reportStudent").value;
  const reportContent = document.getElementById("reportData").innerHTML;
  
  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <html dir="rtl">
      <head>
        <title>×“×•×— ×©×™×¢×•×¨×™× - ${studentName}</title>
        <style>
          body { font-family: Arial; direction: rtl; }
          table { width: 100%; border-collapse: collapse; }
          th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
          th { background: #f0f0f0; }
          .paid { background: #e8f5e8; }
          .unpaid { background: #ffeaea; }
          .overdue { background: #fff3cd; }
        </style>
      </head>
      <body>
        <h1>×“×•×— ×©×™×¢×•×¨×™× - ${studentName || '×›×œ×œ×™'}</h1>
        <p>×ª××¨×™×š: ${new Date().toLocaleDateString('he-IL')}</p>
        ${reportContent}
      </body>
    </html>
  `);
  
  printWindow.document.close();
  printWindow.print();
}

function backupData() {
  const data = {
    students,
    lessons,
    timestamp: new Date().toISOString()
  };
  
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = `lesson_tracker_backup_${new Date().toISOString().slice(0, 10)}.json`;
  link.click();
  
  showNotification('×’×™×‘×•×™ × ×•×¦×¨ ×‘×”×¦×œ×—×”');
}

function importData(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      
      if (data.students && data.lessons) {
        if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×™×™×‘× × ×ª×•× ×™×? ×–×” ×™×—×œ×™×£ ××ª ×›×œ ×”× ×ª×•× ×™× ×”×§×™×™××™×!')) {
          students = data.students;
          lessons = data.lessons;
          saveData();
          
          // ×¨×¢× ×Ÿ ××ª ×›×œ ×”×ª×¦×•×’×•×ª
          renderStudents();
          populateSelects();
          renderDashboard();
          renderCalendar();
          refreshPaymentView();
          refreshReportView();
          refreshFinancialSummary();
          refreshLessonView();
          
          showNotification('× ×ª×•× ×™× ×™×•×‘××• ×‘×”×¦×œ×—×”', 'success');
        }
      } else {
        showNotification('×§×•×‘×¥ ×’×™×‘×•×™ ×œ× ×ª×§×™×Ÿ', 'error');
      }
    } catch (error) {
      showNotification('×©×’×™××” ×‘×§×¨×™××ª ×§×•×‘×¥ ×”×’×™×‘×•×™', 'error');
      console.error('Import error:', error);
    }
  };
  
  reader.readAsText(file);
  event.target.value = ''; // ××™×¤×•×¡ ×”×§×œ×˜
}

function resetAllData() {
  if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×›×œ ×”× ×ª×•× ×™×? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!')) {
    if (confirm('×‘×˜×•×— ×‘×˜×•×—? ×›×œ ×”×ª×œ××™×“×™× ×•×”×©×™×¢×•×¨×™× ×™×™××—×§×•!')) {
      students = [];
      lessons = [];
      localStorage.removeItem('lessonTrackerData');
      
      // ×¨×¢× ×Ÿ ××ª ×›×œ ×”×ª×¦×•×’×•×ª
      renderStudents();
      populateSelects();
      renderDashboard();
      renderCalendar();
      refreshPaymentView();
      refreshReportView();
      refreshFinancialSummary();
      refreshLessonView();
      
      showNotification('×›×œ ×”× ×ª×•× ×™× × ××—×§×•', 'warning');
    }
  }
}
</script>
</body>
</html>
